<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>æˆ‘çš„ä¸–ç•Œ Â· ç¦»çº¿ç‰ˆå“ç‰Œäº’åŠ¨å°æ¸¸æˆ</title>
  <meta name="description" content="Minecraftï¼ˆæˆ‘çš„ä¸–ç•Œï¼‰ä¸»é¢˜ Â· ç¦»çº¿å•æ–‡ä»¶ Â· æ— ä»»ä½•å¤–éƒ¨ä¾èµ–"/>
  <style>
    :root{
      --brand-primary:#3C8527;
      --brand-accent:#2EC4B6;
      --ink-1:#0f172a; /* slate-900 */
      --ink-2:#334155; /* slate-700 */
      --ink-3:#64748b; /* slate-500 */
      --bg-1:#f8fff0;
      --bg-2:#ecfdf5;
      --card:#ffffff;
      --ok:#16a34a;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
      color:var(--ink-1);
      background: linear-gradient(135deg,var(--bg-1),var(--bg-2));
    }
    .container{max-width:1000px;margin:0 auto;padding:24px}
    .title{
      display:flex;align-items:center;gap:12px;margin:0 0 8px 0;
      font-weight:800;letter-spacing:.5px;
    }
    .badge{
      padding:6px 10px;border:1px solid rgba(0,0,0,.06);
      background: rgba(46,196,182,.12); color:#0b5b55; border-radius:999px;
      font-size:12px; font-weight:600
    }
    .subtitle{margin:0;color:var(--ink-2)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:18px}
    @media (max-width:900px){ .grid{grid-template-columns:repeat(6,1fr)} }
    @media (max-width:640px){ .grid{grid-template-columns:repeat(4,1fr)} }
    .card{
      grid-column:span 4;background:var(--card);border-radius:16px;
      border:1px solid rgba(0,0,0,.08); padding:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.06);
      cursor:pointer; user-select:none; transition:transform .08s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease;
      position:relative; overflow:hidden;
    }
    .card:hover{transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,0,0,.08)}
    .card.selected{outline:2px solid var(--brand-accent); border-color:var(--brand-accent); background:linear-gradient(180deg,#ffffff, #ebfffc)}
    .card .k{font-size:13px;color:var(--ink-3);letter-spacing:.2px}
    .card .v{display:flex;align-items:center;gap:10px;margin-top:6px}
    .emoji{font-size:22px}
    .desc{color:var(--ink-2);font-size:14px;margin-top:6px;line-height:1.35}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px dashed rgba(0,0,0,.18);padding:6px 8px;border-radius:10px;background:#fff}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px}
    button{
      appearance:none; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer;
      background:linear-gradient(90deg,var(--brand-primary),var(--brand-accent)); color:white; box-shadow:0 8px 24px rgba(60,133,39,.25);
      transition:transform .06s ease, filter .12s ease;
    }
    button:hover{filter:brightness(1.04)}
    button:active{transform:translateY(1px)}
    .btn-ghost{background:#fff;color:var(--ink-1);border:1px solid rgba(0,0,0,.08);box-shadow:none}
    .muted{color:var(--ink-3);font-size:12px}
    .section{margin-top:22px}
    .section h3{margin:0 0 8px 0}
    .pillset{display:flex;gap:8px;flex-wrap:wrap}
    .pill{
      border-radius:999px;padding:8px 12px;border:1px solid rgba(0,0,0,.1);background:#fff;cursor:pointer;font-weight:600;font-size:14px;
     color:var(--ink-1);}
    .pill.active{border-color:var(--brand-primary); background: #eaffea; color:#14532d}
    .result{
      margin-top:18px; display:none;
    }
    .badgebox{
      display:flex; gap:16px; align-items:center; flex-wrap:wrap;
      border:1px solid rgba(0,0,0,.08); background:#fff; padding:16px; border-radius:16px;
    }
    .pixel{
      width:140px; height:140px; border-radius:16px; position:relative; overflow:hidden;
      background: conic-gradient(from 45deg, #a7f3d0 0 25%, #bef264 0 50%, #86efac 0 75%, #99f6e4 0 100%);
      image-rendering: pixelated; box-shadow: inset 0 0 0 8px rgba(0,0,0,.06);
    }
    .pixel::before, .pixel::after{
      content:""; position:absolute; inset:0;
      background:
        linear-gradient(#0000 15px, rgba(0,0,0,.08) 15px 16px, #0000 16px) 0 0/16px 16px,
        linear-gradient(90deg, #0000 15px, rgba(0,0,0,.08) 15px 16px, #0000 16px) 0 0/16px 16px;
      mix-blend-mode: multiply;
      pointer-events:none;
    }
    .scoretag{font-weight:800;font-size:28px;color:#14532d}
    .tier{font-weight:800}
    .code{background:#0b1220;color:#d1e7ff;padding:12px;border-radius:10px;overflow:auto;font-family:ui-monospace,Consolas,Monaco,monospace;font-size:12px}
    footer{margin:28px 0 12px 0;color:var(--ink-3);font-size:12px}
  </style>
</head>
<body>
  <div class="container">
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <h1 class="title">æˆ‘çš„ä¸–ç•Œ Â· å“ç‰Œäº’åŠ¨å°æ¸¸æˆ</h1>
    </div>
    <p class="subtitle">æ–¹å—ä¹‹ä¸Šï¼Œåˆ›é€ ä½ çš„ä¸–ç•Œã€‚é€‰æ‹©ä½ çš„ç©æ³•ã€æŒ‘é€‰å–œæ¬¢çš„è¦ç´ ï¼Œç”Ÿæˆä½ çš„åƒç´ å¾½ç« å¹¶è®¡ç®—æ®µä½ã€‚</p>

    <div class="section">
      <h3>1. ä½ çš„ç©æ³•</h3>
      <div class="pillset" id="personaSet"></div>
      <div class="muted">ä» <strong>ç”Ÿå­˜ / åˆ›é€  / è”æœº</strong> ä¸­ä»»é€‰å…¶ä¸€ã€‚</div>
    </div>

    <div class="section">
      <h3>2. é€‰æ‹©ä½ æœ€çœ‹é‡çš„è¦ç´ ï¼ˆå¯å¤šé€‰ï¼‰</h3>
      <div class="grid" id="blockGrid"></div>
    </div>

    <div class="controls">
      <button id="goBtn">ç”Ÿæˆæˆ‘çš„åƒç´ å¾½ç« </button>
      <button class="btn-ghost" id="resetBtn">é‡ç½®</button>
    </div>

    <div class="result" id="resultBox">
      <h3>ç»“æœ</h3>
      <div class="badgebox">
        <div class="pixel" aria-hidden="true"></div>
        <div>
          <div>æ®µä½ï¼š<span class="tier" id="tierText">â€”</span></div>
          <div style="margin-top:6px">ç§°å·ï¼š<span class="tier" id="titleText">â€”</span></div>
          <div style="margin-top:6px">æ€»åˆ†ï¼š<span class="scoretag" id="scoreText">0</span></div>
          <div class="muted" style="margin-top:6px">ç©æ³•ï¼š<span id="personaText">â€”</span> Â· è¦ç´ ï¼š<span id="blocksText">â€”</span></div>
          <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap">
            <button id="copyBtn" class="btn-ghost">å¤åˆ¶ç»“æœ JSON</button>
            <button id="saveBtn" class="btn-ghost">ä¿å­˜åˆ°æœ¬åœ°ï¼ˆlocalStorageï¼‰</button>
          </div>
        </div>
      </div>
<div class="muted" style="margin-top:6px">é¡µé¢ä¼šæ´¾å‘ <code>BrandGameComplete</code> äº‹ä»¶ï¼Œdetail å¦‚ä¸Šã€‚ä½ ä¹Ÿå¯ä»¥åœ¨æ§åˆ¶å°ç›‘å¬ï¼š
          <code>window.addEventListener('BrandGameComplete', e => console.log(e.detail))</code>
        </div>
      </div>
    </div>

    <footer>Â© ç¦»çº¿ç‰ˆ Â· Minecraft é…ç½®å·²æ°¸ä¹…å†™å…¥ Â· å¯ç›´æ¥æ‹·è´åˆ†å‘</footer>
  </div>

  <script>
  (function(){
    // â€”â€” æ°¸ä¹…é…ç½®ï¼ˆå†™æ­»åœ¨æ–‡ä»¶é‡Œï¼‰ â€”â€”
    const BRAND_CONFIG = {
      brandKey: "minecraft",
      brandName: "æˆ‘çš„ä¸–ç•Œ",
      slogan: "æ–¹å—ä¹‹ä¸Šï¼Œåˆ›é€ ä½ çš„ä¸–ç•Œ",
      primary: "#3C8527",
      accent: "#2EC4B6",
      proposition: ["ç”Ÿå­˜","åˆ›é€ ","è”æœº"],
      valueBlocks: [
        {"key": "build", "label": "å»ºç­‘", "emoji": "ğŸ—ï¸", "desc": "åƒç´ æ–¹å—ä¹Ÿèƒ½æˆåœ°æ ‡", "weight": 3},
        {"key": "survive", "label": "ç”Ÿå­˜", "emoji": "â›ï¸", "desc": "æ¢ç´¢ã€é‡‡çŸ¿ä¸å¯¹æŠ—å¤œæ™š", "weight": 3},
        {"key": "redstone", "label": "çº¢çŸ³", "emoji": "ğŸ”Œ", "desc": "ç”µè·¯æœºå…³ä¸è‡ªåŠ¨åŒ–æ ¸å¿ƒ", "weight": 5},
        {"key": "adventure", "label": "å†’é™©", "emoji": "ğŸ§­", "desc": "æ¢é™©åœ°ç‰¢é—è¿¹ä¸ä»»åŠ¡", "weight": 3},
        {"key": "coop", "label": "è”æœº", "emoji": "ğŸ¤", "desc": "å’Œå¥½å‹åä½œæ›´æœ‰è¶£", "weight": 2},
        {"key": "creative", "label": "åˆ›é€ ", "emoji": "ğŸ¨", "desc": "æ— é™èµ„æºè‡ªç”±é€ ", "weight": 2},
        {"key": "enchant", "label": "é™„é­”", "emoji": "âœ¨", "desc": "æ”¶é›†ä¸ç»„åˆé™„é­”è¯æ¡", "weight": 3},
        {"key": "alchemy", "label": "ç‚¼è¯", "emoji": "âš—ï¸", "desc": "è°ƒé…è¯æ°´ä¸å¢ç›Š", "weight": 3},
        {"key": "farming", "label": "å†œç‰§", "emoji": "ğŸŒ¾", "desc": "ç§æ¤ç¹è‚²ä¸è‡ªåŠ¨æ”¶å‰²", "weight": 2},
        {"key": "village", "label": "æ‘åº„ç»è¥", "emoji": "ğŸ˜ï¸", "desc": "åˆ·æ‘æ°‘ä¸å¸ƒå±€å®¶å›­", "weight": 3},
        {"key": "trade", "label": "äº¤æ˜“", "emoji": "ğŸ’°", "desc": "åˆ·æŠ˜æ‰£ä¸äº¤æ˜“å¾ªç¯", "weight": 2},
        {"key": "nether", "label": "ä¸‹ç•Œæ”»ç•¥", "emoji": "ğŸ”¥", "desc": "å ¡å’é—è¿¹ä¸äº¤é€šæ¢çº½", "weight": 4},
        {"key": "end", "label": "æœ«åœ°å¾æˆ˜", "emoji": "ğŸ‰", "desc": "å‡»è´¥æœ«å½±é¾™ä¸æ‹“å±•æœ«åœ°", "weight": 5},
        {"key": "ocean", "label": "æµ·æ´‹æ¢ç´¢", "emoji": "ğŸŒŠ", "desc": "æµ·åº•ç¥æ®¿ä¸æ²‰èˆ¹å®è—", "weight": 3},
        {"key": "automation", "label": "è‡ªåŠ¨åŒ–", "emoji": "ğŸ¤–", "desc": "å¾ªç¯ç³»ç»Ÿä¸èµ„æºæµæ°´çº¿", "weight": 5},
        {"key": "railway", "label": "é“è·¯è¿è¾“", "emoji": "ğŸš†", "desc": "çº¢çŸ³è½¦ç«™ä¸ç‰©æµç½‘ç»œ", "weight": 4},
        {"key": "command", "label": "å‘½ä»¤æ–¹å—", "emoji": "ğŸ§ª", "desc": "æŒ‡ä»¤ç¼–ç¨‹ä¸æœºå…³è„šæœ¬", "weight": 5},
        {"key": "mod", "label": "æ¨¡ç»„ç©æ³•", "emoji": "ğŸ§©", "desc": "å·¥ä¸š/é­”æ³•/ç§‘å¹»æ‰©å±•", "weight": 4},
        {"key": "datapack", "label": "æ•´åˆåŒ…", "emoji": "ğŸ“¦", "desc": "é«˜å®šè§„åˆ™ä¸ç©æ³•åˆé›†", "weight": 4},
        {"key": "speedrun", "label": "é€Ÿé€š", "emoji": "âš¡", "desc": "è·¯çº¿ä¼˜åŒ–ä¸æé™æ“ä½œ", "weight": 5},
        {"key": "challenge", "label": "æŒ‘æˆ˜åœ°å›¾", "emoji": "ğŸ¯", "desc": "è§£è°œè·‘é…·ä¸æœºå…³è¯•ç‚¼", "weight": 4},
        {"key": "hardcore", "label": "æé™æ¨¡å¼", "emoji": "ğŸ’€", "desc": "ä¸€æ¡å‘½çš„åˆºæ¿€ä¸æˆå°±", "weight": 5},
        {"key": "aesthetics", "label": "å»ºç­‘ç¾å­¦", "emoji": "ğŸ›ï¸", "desc": "æ¯”ä¾‹ã€æè´¨ä¸å…‰å½±", "weight": 4},
        {"key": "pixelart", "label": "åƒç´ è‰ºæœ¯", "emoji": "ğŸ–¼ï¸", "desc": "é©¬èµ›å…‹ç”»ä¸åœ°æ ‡åƒç´ ", "weight": 3}
      ],
      rewardTiers: [
        { min: 24, title:"çº¢çŸ³å¤§å¸ˆ",   perk:"è§£é”åŠ¨æ€å¤´åƒæ¡†ï¼ˆè™šæ‹Ÿï¼‰" },
        { min: 12, title:"èµ„æ·±å»ºç­‘å¸ˆ", perk:"è§£é”åƒç´ å£çº¸ä¸è´´çº¸åŒ…ï¼ˆè™šæ‹Ÿï¼‰" },
        { min:  0, title:"æ–°æ‰‹çŸ¿å·¥",   perk:"è·å¾—åƒç´ å¾½ç« ä¸ç§°å·ï¼ˆè™šæ‹Ÿï¼‰" },
      ]
    };

        const SPECIAL_CORE = {
      build:"ç­‘å¢ƒå®—å¸ˆ",
      survive:"è’é‡å…¸å®ˆ",
      redstone:"çº¢çŸ³ç„åŒ ",
      adventure:"è¿œå¾æ‹“æ˜Ÿ",
      coop:"åä½œç»Ÿé¢†",
      creative:"é€ å¢ƒç‚¼å¸ˆ",
      enchant:"ç¬¦æ–‡è¯ é‡Šå¸ˆ",
      alchemy:"çµè¯è´¤è€…",
      farming:"ç‰§é‡æ€»ç®¡",
      village:"æ‘æ”¿ç›‘ç†",
      trade:"å•†è·¯è°‹å£«",
      nether:"ä¸‹ç•Œæ‹“ç–†ä½¿",
      end:"æœ«ç©ºé€æ˜Ÿ",
      ocean:"æ·±æ¸Šæµ‹ç»˜å¸ˆ",
      automation:"è‡ªè¿æœºå·§å¸ˆ",
      railway:"é“é“æ€»ç›‘",
      command:"æœ¯å¼æ‰§ä»¤å®˜",
      mod:"æ¨¡ç»„ç¼–æ„å¸ˆ",
      datapack:"æ•´æ ¸æ„åŸŸå¸ˆ",
      speedrun:"éœ†é€Ÿç ´å…³è€…",
      challenge:"ç§˜åŸŸç ´å±€è€…",
      hardcore:"æå¢ƒè§è¯å®˜",
      aesthetics:"åƒç´ ç¾å­¦ç›‘é€ ",
      pixelart:"åƒç´ ç»£ç»˜å¸ˆ"
    };
    const SPECIAL_MODIFIERS = {
      build:"ç­‘å¢ƒå·¥æ³•",
      survive:"ç”Ÿå­˜çº²è¦",
      redstone:"çº¢çŸ³æµæ´¾",
      adventure:"è¿œå¾è°‹ç•¥",
      coop:"è”æœºååŒ",
      creative:"é€ å¢ƒæ€ç»´",
      enchant:"ç¬¦æ–‡æµæ´¾",
      alchemy:"çµè¯å·¥åŠ",
      farming:"ç‰§é‡ä½“ç³»",
      village:"æ‘æ”¿æ³•å…¸",
      trade:"å•†è·¯é‡‘è",
      nether:"ä¸‹ç•Œé€šé€”",
      end:"æœ«ç©ºæ¨è¿›",
      ocean:"æµ·æ¸Šåœ°å½¢",
      automation:"è‡ªåŠ¨åŒ–æµæ°´",
      railway:"è½¨é“ç³»ç»Ÿ",
      command:"å‘½ä»¤æœ¯å¼",
      mod:"æ¨¡ç»„çŸ©é˜µ",
      datapack:"æ•´æ ¸å·¥åŠ",
      speedrun:"é€Ÿé€šè·¯çº¿",
      challenge:"è¯•ç‚¼æœºå…³",
      hardcore:"æé™å®ˆåˆ™",
      aesthetics:"ç¾å­¦è¯­æ±‡",
      pixelart:"åƒç´ ç”»æ´¾"
    };
    const PERSONA_PREFIX = { "ç”Ÿå­˜":"è’é‡", "åˆ›é€ ":"é€ å¢ƒ", "è”æœº":"åä½œ" };
    function makeSpecialTitle(k1, k2, persona){
      const base = SPECIAL_CORE[k1] || "ç‰¹çº§å†’é™©è€…";
      const mod  = k2 ? (SPECIAL_MODIFIERS[k2] || "") : "";
      const pre  = PERSONA_PREFIX[persona] ? PERSONA_PREFIX[persona] + "Â·" : "";
      return `${pre}${base}`;
    }
    function djb2(s){
      let h = 5381;
      for(let i=0;i<s.length;i++){ h = ((h<<5)+h) + s.charCodeAt(i); }
      return h >>> 0;
    }
    function setPixelByKeys(keys){
      const seed = djb2(keys.join('|'));
      const h1 = seed % 360;
      const h2 = (seed >> 7) % 360;
      const h3 = (seed >> 14) % 360;
      const c1 = `hsl(${h1} 80% 80%)`;
      const c2 = `hsl(${h2} 75% 78%)`;
      const c3 = `hsl(${h3} 70% 82%)`;
      const el = document.querySelector('.pixel');
      if(el){
        el.style.background = `conic-gradient(from 45deg, ${c1} 0 25%, ${c2} 0 50%, ${c3} 0 75%, ${c1} 0 100%)`;
      }
    }


    // â€”â€” æ§ä»¶ç»˜åˆ¶ â€”â€”
    const $personaSet = document.getElementById("personaSet");
    const $blockGrid  = document.getElementById("blockGrid");
    const $go         = document.getElementById("goBtn");
    const $reset      = document.getElementById("resetBtn");
    const $resultBox  = document.getElementById("resultBox");
    const $tierText   = document.getElementById("tierText");const $personaText= document.getElementById("personaText");
    const $titleText = document.getElementById("titleText");
    const $scoreText  = document.getElementById("scoreText");
    const $blocksText = document.getElementById("blocksText");
const $copy       = document.getElementById("copyBtn");
    const $save       = document.getElementById("saveBtn");

    
    let __lastResult = null;
// ç©æ³• pills
    let persona = null;
    BRAND_CONFIG.proposition.forEach(p => {
      const el = document.createElement('button');
      el.className = "pill";
      el.textContent = p;
      el.onclick = () => {
        persona = p;
        Array.from($personaSet.children).forEach(c => c.classList.remove('active'));
        el.classList.add('active');
      };
      $personaSet.appendChild(el);
    });

    // è¦ç´  cards
    const selected = new Set();
    BRAND_CONFIG.valueBlocks.forEach(b => {
      const card = document.createElement('div');
      card.className = "card";
      card.setAttribute('role','checkbox');
      card.setAttribute('aria-checked','false');
      card.innerHTML = `
        <div class="k">${b.key}</div>
        <div class="v"><span class="emoji">${b.emoji}</span><strong>${b.label}</strong></div>
        <div class="desc">${b.desc}</div>
      `;
      card.onclick = () => {
        if(selected.has(b.key)){ selected.delete(b.key); card.classList.remove('selected'); card.setAttribute('aria-checked','false'); }
        else { selected.add(b.key); card.classList.add('selected'); card.setAttribute('aria-checked','true'); }
      };
      $blockGrid.appendChild(card);
    });

    function calcScore(){
      let s = 0;
      BRAND_CONFIG.valueBlocks.forEach(b => { if(selected.has(b.key)) s += (b.weight||0); });
      // persona å¯ç»™ä¸ªå°åŠ æˆï¼šé€‰æ‹©å +2 åˆ†ï¼ˆè®©æ®µä½æ›´å®¹æ˜“è·¨æ¡£ï¼‰
      if(persona) s += 2;
      return s;
    }

    function pickTier(score){
      for(const t of BRAND_CONFIG.rewardTiers){
        if(score >= t.min) return t;
      }
      return BRAND_CONFIG.rewardTiers[BRAND_CONFIG.rewardTiers.length-1];
    }

    function renderResult(){
      const score = calcScore();
      const tier  = pickTier(score);
      const data = {
        brandKey: BRAND_CONFIG.brandKey,
        persona: persona,
        blocks: BRAND_CONFIG.valueBlocks.filter(b => selected.has(b.key)).map(b => b.key),
        score,
        tier: { title: tier.title, min: tier.min, perk: tier.perk },
        ts: new Date().toISOString(),
      };
      $tierText.textContent = tier.title;
      $scoreText.textContent = String(score);$personaText.textContent = persona || "â€”";
      $blocksText.textContent = data.blocks.length ? data.blocks.join("ã€") : "â€”";

      // è®¡ç®—ç§°å·ï¼šæŒ‰æƒé‡é€‰å‡ºå‰äºŒå…³é”®è¦ç´ 
      const picks = BRAND_CONFIG.valueBlocks
        .filter(b => selected.has(b.key))
        .sort((a,b) => (b.weight||0) - (a.weight||0) || a.key.localeCompare(b.key));
      let titleStr = "â€”";
      if(picks.length){
        const k1 = picks[0].key;
        const k2 = picks[1] ? picks[1].key : null;
        titleStr = makeSpecialTitle(k1, k2, persona);
      }
      $titleText.textContent = titleStr;
      // æ ¹æ®é€‰æ‹©ç”Ÿæˆåƒç´ å¾½ç« é…è‰²ï¼ˆç¡®ä¿ä¸åŒç»„åˆæœ‰ä¸åŒçš„å›¾æ¡ˆï¼‰
      setPixelByKeys(BRAND_CONFIG.valueBlocks.filter(b => selected.has(b.key)).map(b => b.key).sort());

$resultBox.style.display = "block";

      // äº‹ä»¶æ´¾å‘ï¼ˆä¿æŒä¸åœ¨çº¿ç‰ˆä¸€è‡´ï¼‰
      window.dispatchEvent(new CustomEvent("BrandGameComplete", { detail: data }));
      __lastResult = data;
      return data;
    }

    $go.onclick = () => {
      if(!persona){
        alert("è¯·é€‰æ‹©ä½ çš„ç©æ³•ï¼ˆç”Ÿå­˜ / åˆ›é€  / è”æœºï¼‰");
        return;
      }
      renderResult();
    };

    $reset.onclick = () => {
      persona = null;
      Array.from($personaSet.children).forEach(c => c.classList.remove('active'));
      selected.clear();
      Array.from($blockGrid.children).forEach(c => { c.classList.remove('selected'); c.setAttribute('aria-checked','false'); });
      $resultBox.style.display = "none";
    };

    
    $copy.onclick = async () => {
  try {
    const text = JSON.stringify(__lastResult || { tip: "è¯·å…ˆç‚¹å‡»â€œç”Ÿæˆæˆ‘çš„åƒç´ å¾½ç« â€" }, null, 2);
    await navigator.clipboard.writeText(text);
    $copy.textContent = "å·²å¤åˆ¶";
    setTimeout(() => $copy.textContent = "å¤åˆ¶ç»“æœ JSON", 1200);
  } catch (e) {
    alert("å¤åˆ¶å¤±è´¥ï¼š" + e.message);
  }
};

    $save.onclick = () => {
      const data = renderResult();
      localStorage.setItem("myworld:result", JSON.stringify(data));
      alert("å·²ä¿å­˜åˆ°æœ¬åœ°ï¼ˆlocalStorageï¼‰ã€‚");
    };

    // è‹¥æœ‰å†å²ç»“æœï¼Œå±•ç¤ºä¸€ä¸‹
    try{
      const last = localStorage.getItem("myworld:result");
      if(last){
        const d = JSON.parse(last);
        // æ¢å¤ persona & é€‰ä¸­çŠ¶æ€
        Array.from($personaSet.children).forEach(c => { if(c.textContent === d.persona){ c.classList.add('active'); persona = d.persona; } });
        const keys = new Set(d.blocks||[]);
        BRAND_CONFIG.valueBlocks.forEach((b, i) => {
          if(keys.has(b.key)){
            selected.add(b.key);
            const card = $blockGrid.children[i];
            card.classList.add('selected');
            card.setAttribute('aria-checked','true');
          }
        });
        renderResult();
      }
    }catch(e){ /* ignore */ }
  })();
  </script>
</body>
</html>
